/*
 * Copyright 2020 The edap Project
 *
 * The Netty Project licenses this file to you under the Apache License,
 * version 2.0 (the "License"); you may not use this file except in compliance
 * with the License. You may obtain a copy of the License at:
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations
 * under the License.
 */

package io.edap.protobuf.test.v3;

import com.google.protobuf.InvalidProtocolBufferException;
import io.edap.protobuf.EncodeException;
import io.edap.protobuf.ProtoBuf;
import io.edap.protobuf.ProtoBufException;
import io.edap.protobuf.model.ProtoBufOption;
import io.edap.protobuf.test.message.v3.ListUint32;
import io.edap.protobuf.test.message.v3.OneString;
import io.edap.protobuf.test.message.v3.OneStringNoAccess;
import io.edap.protobuf.test.message.v3.OneStringOuterClass;
import io.edap.util.ClazzUtil;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.params.ParameterizedTest;
import org.junit.jupiter.params.provider.ValueSource;

import java.lang.reflect.Field;

import static io.edap.protobuf.test.TestUtil.conver2HexStr;
import static org.junit.jupiter.api.Assertions.assertArrayEquals;
import static org.junit.jupiter.api.Assertions.assertEquals;

public class TestOneString {

    @ParameterizedTest
    @ValueSource(strings = {
            "",
            "a",
            "abcdefgh",
            "‰∏≠ÊñáÂÜÖÂÆπ",
            "üê∂Â§¥",
            "\u0080",
            "0x3C3F786D6C2076657273696F6E3D27312E302720656E636F64696E673D275554462D38273F3E203C646566696E6974696F6E7320786D6C6E733D22687474703A2F2F7777772E6F6D672E6F72672F737065632F42504D4E2F32303130303532342F4D4F44454C2220786D6C6E733A7873693D22687474703A2F2F7777772E77332E6F72672F323030312F584D4C536368656D612D696E7374616E63652220786D6C6E733A7873643D22687474703A2F2F7777772E77332E6F72672F323030312F584D4C536368656D612220786D6C6E733A61637469766974693D22687474703A2F2F61637469766974692E6F72672F62706D6E2220786D6C6E733A62706D6E64693D22687474703A2F2F7777772E6F6D672E6F72672F737065632F42504D4E2F32303130303532342F44492220786D6C6E733A6F6D6764633D22687474703A2F2F7777772E6F6D672E6F72672F737065632F44442F32303130303532342F44432220786D6C6E733A6F6D6764693D22687474703A2F2F7777772E6F6D672E6F72672F737065632F44442F32303130303532342F44492220747970654C616E67756167653D22687474703A2F2F7777772E77332E6F72672F323030312F584D4C536368656D61222065787072657373696F6E4C616E67756167653D22687474703A2F2F7777772E77332E6F72672F313939392F585061746822207461726765744E616D6573706163653D22687474703A2F2F61637469766974692E6F72672F74657374223E203C70726F636573732069643D2266726565666C6F77466F727761726422206E616D653D22E8BDACE58F91E887AAE794B1E6B581E7A88B2220697345786563757461626C653D2274727565222076657273696F6E49643D22322E30223E203C657874656E73696F6E456C656D656E74733E203C61637469766974693A657865637574696F6E4C697374656E6572206576656E743D2273746172742220636C6173733D22636F6D2E796F6E796F752E62706D2E6C697374656E65722E44656661756C745374617274457865637574696F6E4C697374656E6572222F3E203C61637469766974693A657865637574696F6E4C697374656E6572206576656E743D22656E642220636C6173733D22636F6D2E796F6E796F752E62706D2E6C697374656E65722E44656661756C74457865637574696F6E4C697374656E6572222F3E203C61637469766974693A657865637574696F6E4C697374656E6572206576656E743D22656E642220636C6173733D22636F6D2E796F6E796F752E62706D2E6D6573736167652E64656661756C74496D706C2E45736E4D65737361676553656E6441646170746572222F3E203C2F657874656E73696F6E456C656D656E74733E203C617070726F766553746172744576656E742069643D2273746172744576656E7433363839222061637469766974693A63616E436F6F7065726174696F6E3D2266616C7365222061637469766974693A73656E64546F5369676E6572494D3D2266616C7365222061637469766974693A73656E64546F416C6C55736572494D3D2266616C7365222061637469766974693A73656E64546F53746172746572494D3D2274727565222061637469766974693A63616E436F6D6D656E743D2274727565222061637469766974693A63616E466F72776172643D2274727565223E203C646F63756D656E746174696F6E3E6A756D70546F52656A65637441637469766974793B73656E64546F436F7079546F55736572733B7769746864726177416C6C3C2F646F63756D656E746174696F6E3E203C2F617070726F766553746172744576656E743E203C617070726F7665557365725461736B2069643D22617070726F7665557365725461736B3534393222206E616D653D22E5AEA1E689B9E4BBBBE58AA1222061637469766974693A77697468447261773D2266616C7365222061637469766974693A61737369676E41626C653D2266616C7365222061637469766974693A6164647369676E41626C653D2266616C7365222061637469766974693A72656A65637441626C653D2266616C7365222061637469766974693A63616E426552656A65637465643D2266616C7365222061637469766974693A64656C656761746541626C653D2274727565222061637469766974693A6164647369676E426568696E6441626C653D2266616C7365222061637469766974693A636F7079546F41626C653D2266616C7365222061637469766974693A72656A656374546F456E643D2266616C7365223E203C6D756C7469496E7374616E63654C6F6F7043686172616374657269737469637320697353657175656E7469616C3D2266616C7365222061637469766974693A636F6C6C656374696F6E3D22247B62706D4265616E2E67657455736572282671756F743B7B2770726F636573735061727469636970616E744974656D73273A5B7B2764657461696C73273A5B7B276964273A272461737369676E4C697374277D5D2C2764696664657074273A66616C73652C276C617374417070726F766553616D6564657074273A66616C73652C276C617374417070726F766553616D656F7267273A66616C73652C276C6173744170726F766553616D6544657074496E636C756465486967684C6576656C273A66616C73652C276C6173744170726F766553616D654F7267496E636C756465486967684C6576656C273A66616C73652C276D61726B65724F72674D6772496E636C75646548696768273A66616C73652C276E6F74496E636C7564655061727454696D65273A66616C73652C2773616D6564657074273A66616C73652C2773616D6564657074496E636C756465486967684C6576656C273A66616C73652C2773616D656F7267273A66616C73652C2773616D656F7267496E636C756465486967684C6576656C273A66616C73652C2774797065273A2741535349474E4C495354277D5D7D2671756F743B297D222061637469766974693A656C656D656E745661726961626C653D2261737369676E6565223E203C636F6D706C6574696F6E436F6E646974696F6E3E247B6E724F66436F6D706C65746564496E7374616E6365732F6E724F66496E7374616E6365733D3D317D3C2F636F6D706C6574696F6E436F6E646974696F6E3E203C2F6D756C7469496E7374616E63654C6F6F704368617261637465726973746963733E203C657874656E73696F6E456C656D656E74733E203C61637469766974693A657865637574696F6E4C697374656E6572206576656E743D22656E642220636C6173733D22636F6D2E796F6E796F752E62706D2E6C697374656E65722E4163746976697479456E64457865637574696F6E4C697374656E6572222F3E203C61637469766974693A657865637574696F6E4C697374656E6572206576656E743D2273746172742220636C6173733D22636F6D2E796F6E796F752E62706D2E6C697374656E65722E41637469766974795374617274457865637574696F6E4C697374656E6572222F3E203C61637469766974693A7461736B4C697374656E6572206576656E743D226372656174652220636C6173733D22636F6D2E796F6E796F752E62706D2E6D6573736167652E64656661756C74496D706C2E45736E4D65737361676553656E6441646170746572222F3E203C61637469766974693A7461736B4C697374656E6572206576656E743D22636F6D706C6574652220636C6173733D22636F6D2E796F6E796F752E62706D2E6D6573736167652E64656661756C74496D706C2E45736E4D65737361676553656E6441646170746572222F3E203C61637469766974693A7461736B4C697374656E6572206576656E743D226A756D702220636C6173733D22636F6D2E796F6E796F752E62706D2E6D6573736167652E64656661756C74496D706C2E45736E4D65737361676553656E6441646170746572222F3E203C61637469766974693A7461736B4C697374656E6572206576656E743D2277697468647261772220636C6173733D22636F6D2E796F6E796F752E62706D2E6D6573736167652E64656661756C74496D706C2E45736E4D65737361676553656E6441646170746572222F3E203C61637469766974693A7461736B4C697374656E6572206576656E743D226F757474696D652220636C6173733D22636F6D2E796F6E796F752E62706D2E6D6573736167652E64656661756C74496D706C2E45736E4D65737361676553656E6441646170746572222F3E203C61637469766974693A7461736B4C697374656E6572206576656E743D2264656C6574652220636C6173733D22636F6D2E796F6E796F752E62706D2E6D6573736167652E64656661756C74496D706C2E45736E4D65737361676553656E6441646170746572222F3E203C2F657874656E73696F6E456C656D656E74733E203C2F617070726F7665557365725461736B3E203C656E644576656E742069643D22656E644576656E7431343538222F3E203C73657175656E6365466C6F772069643D2253657175656E6365466C6F77313433362220736F757263655265663D2273746172744576656E743336383922207461726765745265663D22617070726F7665557365725461736B35343932222F3E203C73657175656E6365466C6F772069643D2253657175656E6365466C6F77363837312220736F757263655265663D22617070726F7665557365725461736B3534393222207461726765745265663D22656E644576656E7431343538222F3E203C2F70726F636573733E203C62706D6E64693A42504D4E4469616772616D2069643D2242504D4E4469616772616D5F70726F6365737339323931223E203C62706D6E64693A42504D4E506C616E652062706D6E456C656D656E743D2270726F6365737339323931222069643D2242504D4E506C616E655F70726F6365737339323931223E203C62706D6E64693A42504D4E53686170652062706D6E456C656D656E743D2273746172744576656E7433363839222069643D2242504D4E53686170655F73746172744576656E7433363839223E203C6F6D6764633A426F756E6473206865696768743D2232342E30222077696474683D2232342E302220783D2236302E302220793D2234322E30222F3E203C2F62706D6E64693A42504D4E53686170653E203C62706D6E64693A42504D4E53686170652062706D6E456C656D656E743D22617070726F7665557365725461736B35343932222069643D2242504D4E53686170655F617070726F7665557365725461736B35343932223E203C6F6D6764633A426F756E6473206865696768743D2236302E30222077696474683D223134342E302220783D223132302E302220793D2232342E30222F3E203C2F62706D6E64693A42504D4E53686170653E203C62706D6E64693A42504D4E53686170652062706D6E456C656D656E743D22656E644576656E7431343538222069643D2242504D4E53686170655F656E644576656E7431343538223E203C6F6D6764633A426F756E6473206865696768743D2232342E30222077696474683D2232342E302220783D223330302E302220793D2234322E30222F3E203C2F62706D6E64693A42504D4E53686170653E203C62706D6E64693A42504D4E456467652062706D6E456C656D656E743D2253657175656E6365466C6F7736383731222069643D2242504D4E456467655F53657175656E6365466C6F7736383731223E203C6F6D6764693A776179706F696E7420783D22312E302220793D22322E302220736567496E6465783D2230222F3E203C2F62706D6E64693A42504D4E456467653E203C62706D6E64693A42504D4E456467652062706D6E456C656D656E743D2253657175656E6365466C6F7731343336222069643D2242504D4E456467655F53657175656E6365466C6F7731343336223E203C6F6D6764693A776179706F696E7420783D22312E302220793D22322E302220736567496E6465783D2230222F3E203C2F62706D6E64693A42504D4E456467653E203C2F62706D6E64693A42504D4E506C616E653E203C2F62706D6E64693A42504D4E4469616772616D3E203C2F646566696E6974696F6E733E"
    })
    void testEncode(String value) throws EncodeException {

        OneStringOuterClass.OneString.Builder builder = OneStringOuterClass.OneString.newBuilder();
        builder.setValue(value);
        OneStringOuterClass.OneString oi32 = builder.build();
        byte[] pb = oi32.toByteArray();

        System.out.println("+--------------------+");
        System.out.println(conver2HexStr(pb));
        System.out.println("+--------------------+");
        OneString oneString = new OneString();
        oneString.setValue(value);
        byte[] epb = ProtoBuf.toByteArray(oneString);

        assertArrayEquals(pb, epb);


        ProtoBufOption option = new ProtoBufOption();
        option.setCodecType(ProtoBuf.CodecType.FAST);
        epb = ProtoBuf.toByteArray(oneString, option);
        System.out.println("+-epbf[" + epb.length + "]-------------------+");
        System.out.println(conver2HexStr(epb));
        System.out.println("+--------------------+");

    }

    @Test
    void testEncodeNull() throws EncodeException {
        OneString oneString = new OneString();
        byte[] epb = ProtoBuf.toByteArray(oneString);


        assertArrayEquals(new byte[0], epb);
    }

    @Test
    void testEncodeEmpty() throws EncodeException {
        OneString oneString = new OneString();
        oneString.setValue("");
        byte[] epb = ProtoBuf.toByteArray(oneString);


        assertArrayEquals(new byte[0], epb);
    }

    @ParameterizedTest
    @ValueSource(strings = {
            "",
            "a",
            "abcdefgh",
            "‰∏≠ÊñáÂÜÖÂÆπ",
            "0x3C3F786D6C2076657273696F6E3D27312E302720656E636F64696E673D275554462D38273F3E203C646566696E6974696F6E7320786D6C6E733D22687474703A2F2F7777772E6F6D672E6F72672F737065632F42504D4E2F32303130303532342F4D4F44454C2220786D6C6E733A7873693D22687474703A2F2F7777772E77332E6F72672F323030312F584D4C536368656D612D696E7374616E63652220786D6C6E733A7873643D22687474703A2F2F7777772E77332E6F72672F323030312F584D4C536368656D612220786D6C6E733A61637469766974693D22687474703A2F2F61637469766974692E6F72672F62706D6E2220786D6C6E733A62706D6E64693D22687474703A2F2F7777772E6F6D672E6F72672F737065632F42504D4E2F32303130303532342F44492220786D6C6E733A6F6D6764633D22687474703A2F2F7777772E6F6D672E6F72672F737065632F44442F32303130303532342F44432220786D6C6E733A6F6D6764693D22687474703A2F2F7777772E6F6D672E6F72672F737065632F44442F32303130303532342F44492220747970654C616E67756167653D22687474703A2F2F7777772E77332E6F72672F323030312F584D4C536368656D61222065787072657373696F6E4C616E67756167653D22687474703A2F2F7777772E77332E6F72672F313939392F585061746822207461726765744E616D6573706163653D22687474703A2F2F61637469766974692E6F72672F74657374223E203C70726F636573732069643D2266726565666C6F77466F727761726422206E616D653D22E8BDACE58F91E887AAE794B1E6B581E7A88B2220697345786563757461626C653D2274727565222076657273696F6E49643D22322E30223E203C657874656E73696F6E456C656D656E74733E203C61637469766974693A657865637574696F6E4C697374656E6572206576656E743D2273746172742220636C6173733D22636F6D2E796F6E796F752E62706D2E6C697374656E65722E44656661756C745374617274457865637574696F6E4C697374656E6572222F3E203C61637469766974693A657865637574696F6E4C697374656E6572206576656E743D22656E642220636C6173733D22636F6D2E796F6E796F752E62706D2E6C697374656E65722E44656661756C74457865637574696F6E4C697374656E6572222F3E203C61637469766974693A657865637574696F6E4C697374656E6572206576656E743D22656E642220636C6173733D22636F6D2E796F6E796F752E62706D2E6D6573736167652E64656661756C74496D706C2E45736E4D65737361676553656E6441646170746572222F3E203C2F657874656E73696F6E456C656D656E74733E203C617070726F766553746172744576656E742069643D2273746172744576656E7433363839222061637469766974693A63616E436F6F7065726174696F6E3D2266616C7365222061637469766974693A73656E64546F5369676E6572494D3D2266616C7365222061637469766974693A73656E64546F416C6C55736572494D3D2266616C7365222061637469766974693A73656E64546F53746172746572494D3D2274727565222061637469766974693A63616E436F6D6D656E743D2274727565222061637469766974693A63616E466F72776172643D2274727565223E203C646F63756D656E746174696F6E3E6A756D70546F52656A65637441637469766974793B73656E64546F436F7079546F55736572733B7769746864726177416C6C3C2F646F63756D656E746174696F6E3E203C2F617070726F766553746172744576656E743E203C617070726F7665557365725461736B2069643D22617070726F7665557365725461736B3534393222206E616D653D22E5AEA1E689B9E4BBBBE58AA1222061637469766974693A77697468447261773D2266616C7365222061637469766974693A61737369676E41626C653D2266616C7365222061637469766974693A6164647369676E41626C653D2266616C7365222061637469766974693A72656A65637441626C653D2266616C7365222061637469766974693A63616E426552656A65637465643D2266616C7365222061637469766974693A64656C656761746541626C653D2274727565222061637469766974693A6164647369676E426568696E6441626C653D2266616C7365222061637469766974693A636F7079546F41626C653D2266616C7365222061637469766974693A72656A656374546F456E643D2266616C7365223E203C6D756C7469496E7374616E63654C6F6F7043686172616374657269737469637320697353657175656E7469616C3D2266616C7365222061637469766974693A636F6C6C656374696F6E3D22247B62706D4265616E2E67657455736572282671756F743B7B2770726F636573735061727469636970616E744974656D73273A5B7B2764657461696C73273A5B7B276964273A272461737369676E4C697374277D5D2C2764696664657074273A66616C73652C276C617374417070726F766553616D6564657074273A66616C73652C276C617374417070726F766553616D656F7267273A66616C73652C276C6173744170726F766553616D6544657074496E636C756465486967684C6576656C273A66616C73652C276C6173744170726F766553616D654F7267496E636C756465486967684C6576656C273A66616C73652C276D61726B65724F72674D6772496E636C75646548696768273A66616C73652C276E6F74496E636C7564655061727454696D65273A66616C73652C2773616D6564657074273A66616C73652C2773616D6564657074496E636C756465486967684C6576656C273A66616C73652C2773616D656F7267273A66616C73652C2773616D656F7267496E636C756465486967684C6576656C273A66616C73652C2774797065273A2741535349474E4C495354277D5D7D2671756F743B297D222061637469766974693A656C656D656E745661726961626C653D2261737369676E6565223E203C636F6D706C6574696F6E436F6E646974696F6E3E247B6E724F66436F6D706C65746564496E7374616E6365732F6E724F66496E7374616E6365733D3D317D3C2F636F6D706C6574696F6E436F6E646974696F6E3E203C2F6D756C7469496E7374616E63654C6F6F704368617261637465726973746963733E203C657874656E73696F6E456C656D656E74733E203C61637469766974693A657865637574696F6E4C697374656E6572206576656E743D22656E642220636C6173733D22636F6D2E796F6E796F752E62706D2E6C697374656E65722E4163746976697479456E64457865637574696F6E4C697374656E6572222F3E203C61637469766974693A657865637574696F6E4C697374656E6572206576656E743D2273746172742220636C6173733D22636F6D2E796F6E796F752E62706D2E6C697374656E65722E41637469766974795374617274457865637574696F6E4C697374656E6572222F3E203C61637469766974693A7461736B4C697374656E6572206576656E743D226372656174652220636C6173733D22636F6D2E796F6E796F752E62706D2E6D6573736167652E64656661756C74496D706C2E45736E4D65737361676553656E6441646170746572222F3E203C61637469766974693A7461736B4C697374656E6572206576656E743D22636F6D706C6574652220636C6173733D22636F6D2E796F6E796F752E62706D2E6D6573736167652E64656661756C74496D706C2E45736E4D65737361676553656E6441646170746572222F3E203C61637469766974693A7461736B4C697374656E6572206576656E743D226A756D702220636C6173733D22636F6D2E796F6E796F752E62706D2E6D6573736167652E64656661756C74496D706C2E45736E4D65737361676553656E6441646170746572222F3E203C61637469766974693A7461736B4C697374656E6572206576656E743D2277697468647261772220636C6173733D22636F6D2E796F6E796F752E62706D2E6D6573736167652E64656661756C74496D706C2E45736E4D65737361676553656E6441646170746572222F3E203C61637469766974693A7461736B4C697374656E6572206576656E743D226F757474696D652220636C6173733D22636F6D2E796F6E796F752E62706D2E6D6573736167652E64656661756C74496D706C2E45736E4D65737361676553656E6441646170746572222F3E203C61637469766974693A7461736B4C697374656E6572206576656E743D2264656C6574652220636C6173733D22636F6D2E796F6E796F752E62706D2E6D6573736167652E64656661756C74496D706C2E45736E4D65737361676553656E6441646170746572222F3E203C2F657874656E73696F6E456C656D656E74733E203C2F617070726F7665557365725461736B3E203C656E644576656E742069643D22656E644576656E7431343538222F3E203C73657175656E6365466C6F772069643D2253657175656E6365466C6F77313433362220736F757263655265663D2273746172744576656E743336383922207461726765745265663D22617070726F7665557365725461736B35343932222F3E203C73657175656E6365466C6F772069643D2253657175656E6365466C6F77363837312220736F757263655265663D22617070726F7665557365725461736B3534393222207461726765745265663D22656E644576656E7431343538222F3E203C2F70726F636573733E203C62706D6E64693A42504D4E4469616772616D2069643D2242504D4E4469616772616D5F70726F6365737339323931223E203C62706D6E64693A42504D4E506C616E652062706D6E456C656D656E743D2270726F6365737339323931222069643D2242504D4E506C616E655F70726F6365737339323931223E203C62706D6E64693A42504D4E53686170652062706D6E456C656D656E743D2273746172744576656E7433363839222069643D2242504D4E53686170655F73746172744576656E7433363839223E203C6F6D6764633A426F756E6473206865696768743D2232342E30222077696474683D2232342E302220783D2236302E302220793D2234322E30222F3E203C2F62706D6E64693A42504D4E53686170653E203C62706D6E64693A42504D4E53686170652062706D6E456C656D656E743D22617070726F7665557365725461736B35343932222069643D2242504D4E53686170655F617070726F7665557365725461736B35343932223E203C6F6D6764633A426F756E6473206865696768743D2236302E30222077696474683D223134342E302220783D223132302E302220793D2232342E30222F3E203C2F62706D6E64693A42504D4E53686170653E203C62706D6E64693A42504D4E53686170652062706D6E456C656D656E743D22656E644576656E7431343538222069643D2242504D4E53686170655F656E644576656E7431343538223E203C6F6D6764633A426F756E6473206865696768743D2232342E30222077696474683D2232342E302220783D223330302E302220793D2234322E30222F3E203C2F62706D6E64693A42504D4E53686170653E203C62706D6E64693A42504D4E456467652062706D6E456C656D656E743D2253657175656E6365466C6F7736383731222069643D2242504D4E456467655F53657175656E6365466C6F7736383731223E203C6F6D6764693A776179706F696E7420783D22312E302220793D22322E302220736567496E6465783D2230222F3E203C2F62706D6E64693A42504D4E456467653E203C62706D6E64693A42504D4E456467652062706D6E456C656D656E743D2253657175656E6365466C6F7731343336222069643D2242504D4E456467655F53657175656E6365466C6F7731343336223E203C6F6D6764693A776179706F696E7420783D22312E302220793D22322E302220736567496E6465783D2230222F3E203C2F62706D6E64693A42504D4E456467653E203C2F62706D6E64693A42504D4E506C616E653E203C2F62706D6E64693A42504D4E4469616772616D3E203C2F646566696E6974696F6E733E"
    })
    void testDecode(String value) throws InvalidProtocolBufferException, ProtoBufException {

        OneStringOuterClass.OneString.Builder builder = OneStringOuterClass.OneString.newBuilder();
        builder.setValue(value);
        OneStringOuterClass.OneString pbOneString = builder.build();
        byte[] pb = pbOneString.toByteArray();


        OneStringOuterClass.OneString pbOf = OneStringOuterClass.OneString.parseFrom(pb);

        OneString oneString = ProtoBuf.toObject(pb, OneString.class);


        assertEquals(pbOf.getValue(), oneString.getValue());


        ProtoBufOption option = new ProtoBufOption();
        option.setCodecType(ProtoBuf.CodecType.FAST);
        byte[] epb = ProtoBuf.toByteArray(oneString, option);
        System.out.println("+-epbf[" + epb.length + "]-------------------+");
        System.out.println(conver2HexStr(epb));
        System.out.println("+--------------------+");

        oneString = ProtoBuf.toObject(epb, OneString.class, option);
        assertEquals(pbOneString.getValue(), oneString.getValue());

    }

    @ParameterizedTest
    @ValueSource(strings = {
            "",
            "a",
            "abcdefgh",
            "‰∏≠ÊñáÂÜÖÂÆπ"
    })
    void testEncodeNoAccess(String value) throws EncodeException, NoSuchFieldException, IllegalAccessException {

        OneStringOuterClass.OneString.Builder builder = OneStringOuterClass.OneString.newBuilder();
        builder.setValue(value);
        OneStringOuterClass.OneString oi32 = builder.build();
        byte[] pb = oi32.toByteArray();

        System.out.println("+--------------------+");
        System.out.println(conver2HexStr(pb));
        System.out.println("+--------------------+");

        Field fieldF = ClazzUtil.getDeclaredField(OneStringNoAccess.class, "value");
        fieldF.setAccessible(true);

        OneStringNoAccess oneString = new OneStringNoAccess();
        fieldF.set(oneString, value);
        byte[] epb = ProtoBuf.toByteArray(oneString);

        assertArrayEquals(pb, epb);


        ProtoBufOption option = new ProtoBufOption();
        option.setCodecType(ProtoBuf.CodecType.FAST);
        epb = ProtoBuf.toByteArray(oneString, option);
        System.out.println("+-epbf[" + epb.length + "]-------------------+");
        System.out.println(conver2HexStr(epb));
        System.out.println("+--------------------+");

    }

    @ParameterizedTest
    @ValueSource(strings = {
            "",
            "a",
            "abcdefgh",
            "‰∏≠ÊñáÂÜÖÂÆπ"
    })
    void testDecodeNoAccess(String value) throws InvalidProtocolBufferException, ProtoBufException, NoSuchFieldException, IllegalAccessException {

        OneStringOuterClass.OneString.Builder builder = OneStringOuterClass.OneString.newBuilder();
        builder.setValue(value);
        OneStringOuterClass.OneString oint32 = builder.build();
        byte[] pb = oint32.toByteArray();

        System.out.println("+--------------------+");
        System.out.println(conver2HexStr(pb));
        System.out.println("+--------------------+");

        OneStringOuterClass.OneString pbOf = OneStringOuterClass.OneString.parseFrom(pb);

        OneStringNoAccess oneString = ProtoBuf.toObject(pb, OneStringNoAccess.class);
        Field fieldF = ClazzUtil.getDeclaredField(OneStringNoAccess.class, "value");
        fieldF.setAccessible(true);

        assertEquals(pbOf.getValue(), (String)fieldF.get(oneString));


        ProtoBufOption option = new ProtoBufOption();
        option.setCodecType(ProtoBuf.CodecType.FAST);
        byte[] epb = ProtoBuf.toByteArray(oneString, option);
        System.out.println("+-epbf[" + epb.length + "]-------------------+");
        System.out.println(conver2HexStr(epb));
        System.out.println("+--------------------+");

        oneString = ProtoBuf.toObject(epb, OneStringNoAccess.class, option);
        assertEquals(pbOf.getValue(), fieldF.get(oneString));

    }
}
